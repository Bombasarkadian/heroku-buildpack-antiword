#!/bin/bash
BUILD_DIR=$1

# antiword based on https://github.com/bricel/heroku-buildpack-antiword
INSTALL_DIR=$BUILD_DIR/vendor/antiword/

ANTIWORD_DIR=${HOME}/vendor/antiword/antiword-0.37

echo "Untarring antiword-0.37.tar.gz into ${INSTALL_DIR}"

mkdir -p $INSTALL_DIR
cd $BUILD_DIR
tar -zxvf antiword-0.37.tar.gz -C $INSTALL_DIR
cd ${INSTALL_DIR}antiword-0.37
make

echo "Complete!"
echo "Building runtime environment for antiword int ${BUILD_DIR}"

mkdir -p $BUILD_DIR/.profile.d
echo "makin ${BUILD_DIR}/.profile.d"

echo "export PATH=\"${ANTIWORD_DIR}:\$PATH\"" > $BUILD_DIR/.profile.d/antiword.sh

# pdftotext based on https://github.com/tadas-s/heroku-buildpack-pdftotext
INSTALL_DIR=$BUILD_DIR/vendor/pdftotext/

echo "Copying pdftotext-${STACK} into ${INSTALL_DIR}"

cp "bin/pdftotext-${STACK}" "$INSTALL_DIR/pdftotext"

echo "Complete!"
echo "Building runtime environment for pdftotext int ${BUILD_DIR}"

echo "makin ${BUILD_DIR}/.profile.d"

echo "export PATH=\"${INSTALL_DIR}:\$PATH\"" > $BUILD_DIR/.profile.d/pdftotext.sh

# unrtf based on https://github.com/andre0799/heroku-buildpack-unrtf and https://github.com/bricel/heroku-buildpack-antiword
VERSION=unrtf-0.21.9
INSTALL_DIR=$BUILD_DIR/vendor/unrtf/
UNRTF_DIR=${HOME}/vendor/unrtf/unrtf-0.21.9

echo "Untarring unrtf-0.21.9.tar.gz into ${INSTALL_DIR}"

mkdir -p $INSTALL_DIR
cd $BUILD_DIR
tar -zxvf unrtf-0.21.9.tar.gz -C $INSTALL_DIR
cd ${INSTALL_DIR}unrtf-0.21.9
./configure
make

echo "Complete!"
echo "Building runtime environment for unrtf int ${BUILD_DIR}"

mkdir -p $BUILD_DIR/.profile.d
echo "makin ${BUILD_DIR}/.profile.d"

echo "export PATH=\"${UNRTF_DIR}:\$PATH\"" > $BUILD_DIR/.profile.d/unrtf.sh
